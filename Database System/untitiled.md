#实验一 课程成绩管理数据库

[TOC]

##一、实验目的

1. 理解数据库系统的三级模式结构与两级映像机制;
2. 体会数据库的数据独立性特征;
3. 掌握 ER 模型的使用;
4. 掌握将 ER 模型转换为关系模型的方法;
5. 了解数据库设计的完整过程;
6. 掌握数据库的建立和重构方法;
7. 掌握数据添加、数据删除和数据更新的方法;
8. 掌握各种数据查询方法;
9. 了解数据库的安全性控制机制。

## 二、实验内容

###2.1. 课程成绩管理的业务要求
1. 与课程有关的信息有:课程编号、课程名称、学分;
2. 与学生有关的信息有:学号、姓名、班级;
3. 与教师有关的信息有:工作证编号、姓名、所在学院;
4. 与班级有关的信息有:班级名称;
5. 一名学生属于一个班级，一个班级有多名学生;
6. 一个班级可以开设多门课程，一门课程可能为多个班级开设;
7. 一名学生可以选修为其所在班级开设的多门课程，为一个班级开设的一门课程可以有多名学生选修;
8. 一名教师可以主讲为多个班级开设的多门课程，一门课程可以有多名教师为多个班级主讲，为一个班级开设的一门课程只能由一名教师主讲;
9. 一名学生选修的一门课程只能有一个成绩，这个成绩只能由主讲该生所在班级该课程的教师评定;
10. 对各种数据的格式要求如表1所示;

**表1. 各种格式的要求**
| 数据    | 类型   | 长度   | 其他说明    |
| :---- | :--- | :--- | :------ |
| 课程编号  | 字符   | 6    | 课程的唯一标识 |
| 课程名称  | 字符   | 20   | 无       |
| 学分    | 正整数  | 2    | 无       |
| 学号    | 字符   | 8    | 学生的唯一标识 |
| 姓名    | 字符   | 20   | 无       |
| 班级名称  | 字符   | 16   | 班级的唯一标识 |
| 工作证编号 | 字符   | 6    | 教师的唯一标识 |
| 所在学院  | 字符   | 20   | 无       |
| 成绩    | 非负整数 | 3    | 不大于100  |
11. 开设3门课程，具体信息如表2所示;

**表2. 课程数据表**
| 课程编号   | 课程名称    | 学分   |
| :----- | :------ | :--- |
| 050304 | 计算机科学导引 | 4    |
| 120509 | 建筑力学    | 6    |
| 910201 | 世界科技史   | 3    |
12. 共有 6 名学生，具体信息如表3所示;

**表3. 学生数据表**
| 学号       | 姓名   | 班级     |
| :------- | :--- | :----- |
| 40533123 | 诸葛飞扬 | 信息0519 |
| 40533099 | 雷铭   | 信息0519 |
| 40533103 | 贺舞   | 信息0519 |
| 40525009 | 卫小虎  | 建筑0501 |
| 40525011 | 邵剑青  | 建筑0501 |
| 40525024 | 欧阳雨晨 | 建筑0501 |
13. 共有 5 名教师，具体信息如表4所示;

**表4. 教师数据表**
| 工作证编号  | 姓名   | 所在学院      |
| :----- | :--- | :-------- |
| 032011 | 向华泽  | 信息科学与技术学院 |
| 032036 | 梅鹤   | 信息科学与技术学院 |
| 011221 | 张天啸  | 文法学院      |
| 011224 | 秦放   | 文法学院      |
| 021121 | 萧雁鸣  | 建筑科学与工程学院 |
14. 共有 2 个班级，具体信息如表5所示;

**表5. 班级数据表**
| 班级名称   |
| :----- |
| 信息0519 |
| 建筑0501 |

15. 教务员负责建立和维护课程、班级、教师和学生的档案，为各班开设课程，为各个班的各门课程分配主讲教师，按班级打印各门课程每个学生的成绩并计算平均成绩。各班课程开设及主讲教师分配情况如表6所示;

**表6. 各班课程开设及主讲教师分配情况**
| 班级     | 课程      | 主讲教师 |
| :----- | :------ | :--- |
| 信息0519 | 计算机科学导引 | 向华泽  |
| 信息0519 | 世界科技史   | 张天啸  |
| 建筑0501 | 计算机科学导引 | 梅鹤   |
| 建筑0501 | 建筑力学    | 萧雁鸣  |
| 建筑0501 | 世界科技史   | 秦放   |
16. 学生可以选课和查看成绩;
17. 教师负责给出成绩、更正成绩和按班级打印各门课程每个学生的成绩并计算平均成绩;
18. 学生选课情况如表7所示;

**表7. 学生选课情况**
| 学生   | 课程      | 班级     |
| :--- | :------ | :----- |
| 诸葛飞扬 | 计算机科学导引 | 信息0519 |
| 诸葛飞扬 | 世界科技史   | 信息0519 |
| 雷铭   | 计算机科学导引 | 信息0519 |
| 雷铭   | 世界科技史   | 信息0519 |
| 贺舞   | 计算机科学导引 | 信息0519 |
| 贺舞   | 世界科技史   | 信息0519 |
| 卫小虎  | 计算机科学导引 | 建筑0501 |
| 卫小虎  | 建筑力学    | 建筑0501 |
| 卫小虎  | 世界科技史   | 建筑0501 |
| 邵剑青  | 建筑力学    | 建筑0501 |
| 邵剑青  | 世界科技史   | 建筑0501 |
| 欧阳雨晨 | 计算机科学导引 | 建筑0501 |
| 欧阳雨晨 | 建筑力学    | 建筑0501 |
19. 学生各门课程成绩如表8所示;

**表8. 学生各门课程成绩**
| 学生   | 课程      | 成绩   |
| :--- | :------ | :--- |
| 诸葛飞扬 | 计算机科学导引 | 85   |
| 诸葛飞扬 | 世界科技史   | 77   |
| 雷铭   | 计算机科学导引 | 69   |
| 雷铭   | 世界科技史   | 88   |
| 贺舞   | 计算机科学导引 | 75   |
| 贺舞   | 世界科技史   | 89   |
| 卫小虎  | 计算机科学导引 | 84   |
| 卫小虎  | 建筑力学    | 90   |
| 卫小虎  | 世界科技史   | 79   |
| 邵剑青  | 建筑力学    | 80   |
| 邵剑青  | 世界科技史   | 72   |
| 欧阳雨晨 | 计算机科学导引 | 81   |
| 欧阳雨晨 | 建筑力学    | 83   |
###2.2. 实验任务
1. 根据业务要求建立数据库
2. 根据业务要求建立该数据库的用户
3. 根据业务要求以不同的用户身份使用该数据库
##三、实验步骤
###3.1. 使用ER模型进行概念设计

**图1. 课程成绩管理数据库系统的 ER 模型**

![图1](图1.png)

###3.2. 将得到的 ER 模型转换成关系模型

####Entity:

- 学生(学号，姓名，班级)。

- 课程(课程号，课程名称，学分)。

- 教师(工作证编号，姓名，学院)。

####Relationship:

- 选修(学号，课程号，分数 )。 
- 主讲(工作证编号，课程号，班级)。 

####英文表示:

- Student(Sno,Sname,Ssex,Class) ;
- Course(Cno,Cname,Cridet) ; 
- Teacher(Tno,Tname,Tdept) ;
- Enrollment(Sno,Cno,Grade) ; 
- TeachCourse(Tno,Cno,Class) ;
###3.3. 定义数据库模式(全局模式)

利用Navicat Premium软件建立relation schema，之后各个实体和关系以视图模式展现出来。从图中可以看到各个实体或关系之中所包含的属性以及key或foreign key，通过foreign key的存在理解各实体之间的联系。

**图2. 数据库模式示意图**

![图2](图2.jpeg)

###3.4. 定义数据库外模式(子模式)

创建 Grade 视图，供学生和教师查询。

```mysql
CREATE VIEW dbo.Grade
AS
SELECT dbo.Student.Class, dbo.Student.Sname, dbo.Course.Cname, dbo.Course.Credit,
dbo.Enrollment.Grade FROM dbo.Enrollment INNER JOIN
dbo.Course ON dbo.Enrollment.Cno = dbo.Course.Cno INNER JOIN
dbo.Student ON dbo.Enrollment.Sno = dbo.Student.Sno
```
**图3. 数据库外模式grade示意图**

![图3](图3-2.png)

**图4. 数据库外模式grade具体内容**

![图3](图3.png)

###3.5. 定义数据库用户:

1. 教务员：

  ```mysql
  GRANT ALL PRIVILEGES ON Student, Course, Teacher, TeachCourse TO Dean;
  ```

  **图5. 教务员权限**

  ![图4](图4.png)

2. 学生：

  ```mysql
  GRANT SELECT, INSERT(Sno,Cno), UPDATE(Sno,Cno) ON Enrollment TO Student
  ```

  **图6. 学生权限**

  ![图5](图5.png)

3. 教师：

  ```mysql
  GRANT SELECT, INSERT(Sno,Cno), UPDATE(Sno,Cno) ON Enrollment TO Student
  ```

  **图7. 教师权限**

  ![图6](图6.png)

###3.6. 以不同用户的身份使用数据库:

1. 以教务员的身份输入课程、学生、教师的数据，并为课程分配教师;
  以教务员身份插入课程数据

  **图8. 以教务员的身份输入课程**

  ![图7](图7.png)

  **图9. 以教务员的身份输入学生数据**

  ![图8](图8.png)
  ![图8-2](图8-2.png)

  **图10. 以教务员的身份输入教师数据**

  ![图9](图9.png)

  **图11. 以教务员身份为课程分配老师**

  ![图10](图10.png)

2. 以学生的身份选课;

  **图12. 以学生的身份选课**

  ![图11](图11.png)
  ![图11-2](图11-2.png)

3. 以教师的身份给出成绩;

  **图13. 以教师的身份给出成绩**

  ![图12](图12.png)

4. 以学生的身份查看成绩;

  **图14. 以学生的身份查看成绩**

  ![图13](图13.png)

5. 以教师的身份更改成绩;

  **图15. 以教师的身份更改成绩**

  ![图14](图14.png)

6. 以教务员的身份更改成绩;

  **图16. 以教务员的身份更改成绩**

  ![图15](图15.png)

7. 以教师的身份打印成绩单;
  ```mysql
     select Student.Sno, Sname, Grade from Enrollment, Student where(Enrollment.Sno=Student.Sno) and Class='建筑0501';
     select Student.Sno, Sname, Grade from Enrollment, Student where(Enrollment.Sno=Student.Sno) and Class='信息0519';
     SELECT Class, AVG(Grade) FROM Enrollment, Student where(Enrollment .Sno = Student.Sno)GROUP BY Class;
  ```
  **图17. 以教师的身份打印成绩单**

  ![图16](图16.png)


8. 以教务员的身份打印成绩单。

  **图18. 以教务员的身份打印成绩单**

  ![图16](图16.png)

###3.7. 重新分配用户权限

收回教师的更改成绩权限，分配给教务员更改成绩权限。

  **图19. 收回教师的更改成绩权限**

  ![图18](图18.png)

  **图20. 分配给教务员更改成绩权限**

  ![图19](图19.png)

###3.8. 以不同用户的身份使用数据库:

1. 以教师的身份更改成绩;

  **图21. 以教师的身份更改成绩**

  ![图20](图20.png)

2. 以教务员的身份更改成绩;

  **图22. 以教务员的身份更改成绩**

  ![图21](图21.png)

3. 以教师的身份打印成绩单;

  **图23. 以教师的身份打印成绩单**

  ![图22](图22.png)

4. 以教务员的身份打印成绩单。
5. 
  **图24. 以教务员的身份打印成绩单**

  ![图23](图22.png)

###3.9. 修改数据库模式

- 在教师信息中增加“职称”一项(字符类型，长度为 6)， 并且删除“所在学院”一项。

**图25. 修改教师信息**

![图24](图24.png)

在新添属性时，初值都设置为NULL。

###3.10. 以不同的身份使用数据库:

1. 以学生的身份查看成绩;

  **图26. 以学生的身份查看成绩**

  ![图25](图25.png)

2. 以教师的身份打印成绩单;

  **图27. 以教师的身份打印成绩单**

  ![图26](图26.png)

3. 以教务员的身份增加一名教师。

  **图28. 增加一名教师（非法属性）**

  ![图27](图27.png)

  在修改过属性之后，就必须按新属性来添加一个记录。否则将插入失败。

  **图29. 增加一名教师（合法属性）**

  ![图28](图28.png)

##四、思考题

###1. 数据库系统的三级模式结构与两级映像机制在 mysql 中是如何实现的?

​	为了解决这个问题，我们首先要搞清楚三级模式结构和两级映像机制的基本概念。数据库的三级模式结构是指外模式、模式和内模式。二级映射就是内模式与模式之间的映射和外模式与模式之间的映射。

​	具体来说：模式是指逻辑模式，即数据库中全体数据的逻辑结构和属性的描述，是所有用户的公共数据视图，既不涉及到数据的物理存储细节和硬件环境，也与具体的应用程序、应用开发工具以及高级程序设计语言无关。 外模式是数据库用户能够看到和使用的局部数据的逻辑结构和特征的描述，是数据库的数据视图，是与某一个应用有关的数据的逻辑表示。 内模式为存储模式，是数据库物理结构和存储方式的描述，是数据在数据库内部的表示方式。

​	模式是数据库数据在逻辑上的视图，在mysql中，其模式事实上包含了其中存储的各个表，每个表的名字，其中的属性，属性类型、取值范围，主键，外键，索引和其他完整性约束。在创建数据库的过程中，实际上就是对模式进行建立。

​	外模式是保证数据库安全性的措施，每个用户只能看见和访问所对应的外模式中的数据，其余数据不可见。在mysql中的graph就是一种外模式。例如在本实验中，生成了一个Grade视图，方便学生和教师的查阅数据，其中包含了班级、学生姓名、课程名、学分及成绩，是由数据库中各个表连接起来之后选取部分属性组成的一个子表，包含的数据是从数据库所有表中选择部分出来的。

​	数据库内模式包含了记录的存储方式（一般包含堆存储，升/降存储，聚簇存储索引），组织方式（常见B+树索引，hash索引等）。在mysql，具体的存储与数据库管理员选择的存储引擎有关，如果选择的存储引擎是MYISAM ，则数据存储在 .MYD 文件中；如果选择的是 innodb 存储引擎，则数据是统一存储在一个叫 ibdata1 的文件中的，这个文件一般位于各个数据库目录的上一级目录下。

​	以上三个模式使得用户能够逻辑地抽象地处理数据，而不必再去关心数据在计算机中的具体表示方式与存储方式。为了实现这三个抽象层次之间的联系和转换，外模式/模式映像和模式/内模式映像被设计出来，保证数据库中的数据能够具有较高的逻辑独立性和物理独立性。

​	每一数据库都可以有多个外模式，每个外模式都对应有一个外模式/模式映像，其定义了这个外模式与模式的对应关系。当模式改变时，由数据库管理员对各个外模式/模式映像作相应的改变，可以使得外模式保持不变。由于应用程序应该是依据外模式编写的，从而应用程序不必修改，这就保证了数据与程序的逻辑独立性。

​	每个数据库都只有一个模式，一个内模式，所以只有一个统一的模式/内模式映像，定义数据全局逻辑结构与存储结构之间的对应关系。 当数据库的存储结构改变时，例如改变mysql的存储引擎，由数据库管理员对模式/内模式映像作出相应的改变，可以使得模式保持不变，从而应用程序也不必改变。这就保证了数据和程序的物理独立性。

###2. 本实验中如何发挥数据库的数据独立性优点?

​	数据独立性是指应用程序和数据之间相互独立，数据结构的修改不会引起应用程序的修改，包括物理数据独立性和逻辑数据独立性。物理数据独立性是指数据库物理结构改变时不必修改现有的应用程序，逻辑数据独立性是指数据库逻辑结构改变时不用改变应用程序。数据独立性是由数据库管理系统的二级映像功能来实现的。

​	在本实验中主要发挥了其数据逻辑独立性，在改变模式时，例如增加学生或老师的记录，添加学生成绩等，通过外模式／模式的映像的改变，Grade视图中相应地也会增加一条学生的记录，显示学生成绩等，但其逻辑结构不会改变，即学生或者老师在通过Grade视图查阅相关数据时，显示的结构（表名，属性个数、属性类型等）都不会改变，只是某条记录的具体数据改变了。这样除了学生和老师查阅出的结构不改变，应用程序需要访问这些数据时，其访问的方式也不会改变，就不需要修改具体的应用程序，使数据和应用程序之间相互独立。

###3. 在数据库设计过程中 ER 模型起到什么作用?

​	ER模型是实体关系模型，其包含了数据库中的数据及其关系。在数据库设计的第一个阶段需求分析过程中，使用ER模型来描述信息需求或要存储在数据库中的信息类型。将设计出的ER模型映射到逻辑数据模型（关系模型），之后将关系模型映射到物理模型。将实际商业中的物体（例如本实验中的学生、老师等）设计成ER模型中的“Entity”，将这些物体是如何相互联系的设计成ER模型中的“Relation”，通过“Entity”和“Relation”将所设计的数据库中的各个概念可视化表示。通过将这些数据库设计想法可视化，数据库设计人员可以有一个纠错的机会，在开始建立数据库之前精简设计并且改正错误。

###4. 本实验中数据库的安全性控制机制如何发挥作用?

​	在数据库管理过程中，为数据库设置不同的用户（如本实验的老师、学生、教务员等），这些不同的用户有着不同的操作数据库和各个表的权限（不可读、只读、读写等），以防止不合法的使用造成的数据泄密、更改或破坏。例如学生有Student表的只读权限和Enrollment表的读、插入和修改权限（没有删除的权限），这样他就只能看自己的学号和班级信息，进行选课等，但不能退课，或查看其他信息。数据库安全行控制就是通过种种防范措施，给各个用户设置特定的权限，防止用户越权使用数据库。

##五、实验结论与分析
###1. 数据独立性分析

​	数据独立性通一般过数据库管理系统的二级映射得以实现，用以保证应用程序和数据之间相互独立，包含物理数据独立性和逻辑数据独立性。

​	实验中的逻辑独立性体现在：改变模式时，例如向mysql中的课程成绩管理数据库中的表中添加记录，或修改某条记录时，在外模式/模式的映像中增加或修改该条记录的映射方式，使外模式保持不变，从而导致外模式的视图结构，用户在访问外模式时，看到的还是同样结构的表，同样应用程序也有相同的访问或调用方式，而无需改变应用程序。具体来说，在增加一个学生或更新学生成绩等，通过外模式／模式的映像的改变，Grade视图中相应地也会增加一条学生的记录，显示学生成绩等，但其逻辑结构不会改变，即学生或者老师在通过Grade视图查阅相关数据时，显示的结构（表名，属性个数、属性类型等）都不会改变，只是某条记录的具体数据改变了。

​	除了改变具体某个实例之外，如果进行模式中的结构的改变，只要映射方式适当，并不会影响外模式的结构。例如实验中对Teacher表中的“Tdept”属性删除，增加“Position”属性，但由于Grade视图中并不包含教师的“Tdept”信息，所以将其删除并不会对Grade造成影响。但如果Grade视图中包含了教师的“Tdept”信息，将其删除，Grade势必需要改变，这时就需要对访问Grade的应用程序作出调整。需要注意的是，此时实际上更改了数据库的用户需求，必然会对外模式造成影响，这种情况下并不属于逻辑独立性所需要考虑的范围之内。

​	物理独立性主要指数据的存储结构发生变化时，调整模式/内模式映射，重新定义数据全局逻辑结构与存储结构之间的对应关系，以确保模式不改变。在实验中，每个表格的物理存储方式默认都使用的是InnoDB，但实际上，还有其他很多的存储方式可选择。当从InnoDB换到其他的表格类型时，用户所看到的模式并不会改变。

**图30.表格建立时的可选类型**

![图29](图29.png) 

​	除了表格类型之外，实验中还可以对具体的索引进行设置，在实验中利用的Btree作为默认的索引类型，当将索引类型改变成Hash时，用户所访问的模式同样不会改变。

**图31.TeachCourse表格中属性的索引类型**

![图30](图30.png) 

###2. 安全性控制机制

​	在实验中，课程成绩管理数据库提供了多种用户，包括数据库管理员、教务员、老师和学生等，不同的用户有不同的操作数据库和表的权限。

- 数据库管理员拥有对数据库及其所属表的全部权限

- 教务员有对“Student”，“Course”，“Teacher”，“TeachCourse”表的全部权限

- 教师有对“Enrollment”中学生成绩进行查看和更新的权限

- 学生有对“Enrollment”中插入和更新学生选课记录的权限

 MySQL将权限分为全局权限与对象权限。所谓的全局权限是与数据库、表、视图等不相干的权限，如密码的设置、用户的创建等。对象权限是相对于全局权限的，也就是与数据库、表、视图、列、索引等一切对象相关的权限。在本实验的数据库管理系统中，只有数据库管理员有全局权限，其他教务员、老师和学生都只是对象权限。

MYSQL会验证使用的用户具体的数据库及其所属表权限，这样就防止了不合法的使用造成的数据泄密、更改或破坏。例如学生有对“Enrollment”表的读、插入和修改权限（没有删除的权限），这样他就只能进行选课等，但不能退课。在使用过程中，还可以根据具体情况更改某一用户的授权。在实验中，刚开始时教师有对学生成绩进行更新的权限，而教务员没有，但当教师登记完学生成绩之后，就可以取消教师的修改成绩的权限，而分配给教务员该权限，这样就防止教师滥用权限，随意修改学生成绩等问题。

###3. 实验结论

​	实验中，我跟随实验文档完成了对课程成绩管理数据库的设计过程，了解数据库设计的完整过程。通过ER模型设计课程成绩管理数据库，我掌握了 ER 模型的使用。通过将概念设计的ER模型映射到逻辑数据模型，即关系模型关系模型，我也掌握将 ER 模型转换为关系模型的方法。在设计完数据库之后，我在MYSQL中建立了课程成绩管理数据库，掌握数据库的建立和重构方法。在具体实战中，我也学习了数据添加、数据删除、数据更新和数据查询的方法，熟悉了SQL语言中DML与DDL语言的使用。通过对模式级别的各个实体和其关系的表格的创建，以及外模式级别的Grade视图的建立，深入理解了理解数据库系统的三级模式结构与两级映像机制的原理和在MYSQL中的应用。通过对模式级别的表格的插入、更新和删除，对比模式级别与外模式级别所展示的内容找出改变的部分，体会了体会数据库的数据独立性特征。最后通过给教师和教务员分配和回收权限，了解数据库的安全性控制机制。